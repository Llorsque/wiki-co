const sb=document.getElementById("searchInput");const panel=document.getElementById("searchPanel");const results=document.getElementById("results");async function getIndex(){const res=await fetch((window.siteBase||"")+"/search.json?"+Date.now());return res.json()}let INDEX=null;if(sb){sb.addEventListener("input",async e=>{const q=e.target.value.trim().toLowerCase();if(!q){panel.hidden=true;results.innerHTML="";return}if(!INDEX)INDEX=await getIndex();const norm=t=>t.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'');const qq=norm(q);const list=INDEX.map(it=>({...it,_score:(norm(it.title).includes(qq)?3:0)+(norm(it.category||'').includes(qq)?2:0)+(norm(it.content).includes(qq)?1:0)})).filter(x=>x._score>0).sort((a,b)=>b._score-a._score).slice(0,40);results.innerHTML=list.length?list.map(r=>`<div class="result"><a href="${r.url}">${r.title}</a><p>${r.snippet||''}</p></div>`).join(''):`<div class="result">Geen resultaten</div>`;panel.hidden=false});document.addEventListener('keydown',e=>{if(e.key==='Escape'){panel.hidden=true}})}